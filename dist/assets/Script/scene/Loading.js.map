{"version":3,"sources":["../../../../assets/Script/scene/Loading.js"],"names":["GD","require","ClientKernel","cc","Class","extends","Component","properties","bar","default","type","ProgressBar","label","Label","onLoad","init","bindObj","push","onfire","on","onLogonSuccess","bind","onDestroy","i","length","un","progress","string","clientKernel","logonSubgame","audioMgr","loadAudioDir","playMusic","loadGame","self","loader","onProgress","completedCount","totalCount","item","toFixed","director","preloadScene","scheduleOnce","loadScene"],"mappings":";;AAAA,IAAIA,KAAKC,QAAQ,IAAR,CAAT;AACA,IAAIC,eAAeD,QAAQ,cAAR,CAAnB;;AAEAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,aAAK;AACDC,qBAAS,IADR;AAEDC,kBAAMP,GAAGQ;AAFR,SADG;AAKRC,eAAO;AACHH,qBAAS,IADN;AAEHC,kBAAMP,GAAGU;AAFN;;AALC,KAHP;;AAgBLC,UAhBK,oBAgBI;AACL,aAAKC,IAAL;AACA,aAAKC,OAAL,GAAe,EAAf;AACA,aAAKA,OAAL,CAAaC,IAAb,CAAkBC,OAAOC,EAAP,CAAU,gBAAV,EAA4B,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAA5B,CAAlB;AAEH,KArBI;AAuBLC,aAvBK,uBAuBO;AACR,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,KAAKP,OAAL,CAAaQ,MAAjC,EAAyCD,GAAzC,EAA8C;AAC1CL,mBAAOO,EAAP,CAAU,KAAKT,OAAL,CAAaO,CAAb,CAAV;AACH;AAEJ,KA5BI;AA+BLR,QA/BK,kBA+BE;AACH,aAAKP,GAAL,CAASkB,QAAT,GAAoB,CAApB;AACA,aAAKd,KAAL,CAAWe,MAAX,GAAoB,EAApB;AACA,YAAI,CAAC3B,GAAG4B,YAAR,EAAsB;AAClB5B,eAAG4B,YAAH,GAAkB,IAAI1B,YAAJ,EAAlB;AACH;AACDF,WAAG4B,YAAH,CAAgBC,YAAhB,GANG,CAM4B;AAElC,KAvCI;;;AA0CL;AACAT,kBA3CK,4BA2CY;AAAA;;AACb;AACApB,WAAG8B,QAAH,CAAYC,YAAZ,CAAyB,OAAzB,EAAkC,YAAM;AACpC/B,eAAG8B,QAAH,CAAYE,SAAZ,CAAsB,gBAAtB,EADoC,CACI;AACxC,kBAAKC,QAAL;AACH,SAHD;AAKH,KAlDI;AAoDLA,YApDK,sBAoDM;AACP,YAAIC,OAAO,IAAX;AACA/B,WAAGgC,MAAH,CAAUC,UAAV,GAAuB,UAASC,cAAT,EAAyBC,UAAzB,EAAqCC,IAArC,EAA2C;AAC9D,gBAAIb,WAAW,CAAf;AACA,gBAAIY,cAAc,CAAlB,EAAqB;AACjBZ,2BAAW,CAACW,iBAAiBC,UAAlB,EAA8BE,OAA9B,CAAsC,CAAtC,CAAX;AACH;AACD;AACAN,iBAAK1B,GAAL,CAASkB,QAAT,GAAoBA,QAApB;AACAQ,iBAAKtB,KAAL,CAAWe,MAAX,GAAoB,CAACD,WAAW,GAAZ,EAAiBc,OAAjB,KAA6B,GAAjD;AAEH,SATD;;AAWA;AACArC,WAAGsC,QAAH,CAAYC,YAAZ,CAAyB,MAAzB,EAAiC,YAAW;AACxCR,iBAAKS,YAAL,CAAkB,YAAM;AACpBxC,mBAAGgC,MAAH,CAAUC,UAAV,GAAuB,IAAvB;AACAjC,mBAAGsC,QAAH,CAAYG,SAAZ,CAAsB,MAAtB;AACH,aAHD,EAGG,GAHH;AAKH,SAND;AAOH;AAzEI,CAAT","file":"Loading.js","sourcesContent":["var GD = require(\"GD\");\r\nvar ClientKernel = require(\"ClientKernel\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bar: {\r\n            default: null,\r\n            type: cc.ProgressBar,\r\n        },\r\n        label: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n    },\r\n\r\n\r\n    onLoad() {\r\n        this.init();\r\n        this.bindObj = [];\r\n        this.bindObj.push(onfire.on(\"onLogonSuccess\", this.onLogonSuccess.bind(this)))\r\n\r\n    },\r\n\r\n    onDestroy() {\r\n        for (var i = 0; i < this.bindObj.length; i++) {\r\n            onfire.un(this.bindObj[i])\r\n        }\r\n\r\n    },\r\n\r\n\r\n    init() {\r\n        this.bar.progress = 0;\r\n        this.label.string = \"\";\r\n        if (!GD.clientKernel) {\r\n            GD.clientKernel = new ClientKernel();\r\n        }\r\n        GD.clientKernel.logonSubgame() //登录子游戏  登录成功会进 onLogonSuccess\r\n\r\n    },\r\n\r\n\r\n    //登录成功\r\n    onLogonSuccess() {\r\n        //先加载音效\r\n        GD.audioMgr.loadAudioDir(\"sound\", () => {\r\n            GD.audioMgr.playMusic(\"sound/bg_music\") //开始播背景音乐\r\n            this.loadGame()\r\n        })\r\n\r\n    },\r\n\r\n    loadGame() {\r\n        let self = this;\r\n        cc.loader.onProgress = function(completedCount, totalCount, item) {\r\n            var progress = 1;\r\n            if (totalCount != 0) {\r\n                progress = (completedCount / totalCount).toFixed(2);\r\n            }\r\n            //这里显示loading进度\r\n            self.bar.progress = progress;\r\n            self.label.string = (progress * 100).toFixed() + \"%\"\r\n\r\n        };\r\n\r\n        //预加载场景\r\n        cc.director.preloadScene(\"game\", function() {\r\n            self.scheduleOnce(() => {\r\n                cc.loader.onProgress = null;\r\n                cc.director.loadScene(\"game\");\r\n            }, 0.3);\r\n\r\n        });\r\n    },\r\n\r\n});"]}
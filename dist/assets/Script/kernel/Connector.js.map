{"version":3,"sources":["../../../../assets/Script/kernel/Connector.js"],"names":["SocketIO","window","io","Connector","sock","isConnecting","isConnect","activeDisConnect","uri","serverURI","cc","log","connect","reconnection","on","onConnect","bind","onDisconnect","onError","onMsg","data","onfire","fire","eventName","close","route","console","error","emit","module","exports"],"mappings":";;;;;;AAAA,IAAIA,WAAWA,YAAYC,OAAOC,EAAlC;;IAGMC,S;AACF,yBAAc;AAAA;;AACV,aAAKC,IAAL,GAAY,IAAZ;AACA,aAAKC,YAAL,GAAoB,KAApB;AACA,aAAKC,SAAL,GAAiB,KAAjB;AACA,aAAKC,gBAAL,GAAwB,KAAxB;AACH;;;;gCAEOC,G,EAAK;AACT,iBAAKC,SAAL,GAAiBD,GAAjB;AACA,iBAAKJ,IAAL,GAAY,IAAZ;AACA,iBAAKC,YAAL,GAAoB,IAApB;;AAEAK,eAAGC,GAAH,CAAO,UAAP,EAAmBH,GAAnB;AACA,iBAAKJ,IAAL,GAAYJ,SAASY,OAAT,CAAiBJ,GAAjB,EAAsB;AAC9BK,8BAAc;AADgB,aAAtB,CAAZ;AAGA;AACA,iBAAKT,IAAL,CAAUU,EAAV,CAAa,SAAb,EAAwB,KAAKC,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAxB;AACA,iBAAKZ,IAAL,CAAUU,EAAV,CAAa,YAAb,EAA2B,KAAKG,YAAL,CAAkBD,IAAlB,CAAuB,IAAvB,CAA3B;AACA,iBAAKZ,IAAL,CAAUU,EAAV,CAAa,OAAb,EAAsB,KAAKI,OAAL,CAAaF,IAAb,CAAkB,IAAlB,CAAtB;AACA,iBAAKZ,IAAL,CAAUU,EAAV,CAAa,KAAb,EAAoB,KAAKK,KAAL,CAAWH,IAAX,CAAgB,IAAhB,CAApB;AACH;;;kCAESI,I,EAAM;AACZV,eAAGC,GAAH,CAAO,WAAW,KAAKF,SAAvB;AACA,iBAAKH,SAAL,GAAiB,IAAjB;AACA,iBAAKD,YAAL,GAAoB,KAApB;AACAgB,mBAAOC,IAAP,CAAY,WAAZ,EAAyBF,IAAzB;AACH;;;qCAEYA,I,EAAM;AACfV,eAAGC,GAAH,CAAO,UAAP,EAAmBS,IAAnB;AACA,iBAAKd,SAAL,GAAiB,KAAjB;AACA,iBAAKD,YAAL,GAAoB,KAApB;AACA,iBAAKD,IAAL,GAAY,IAAZ;AACAiB,mBAAOC,IAAP,CAAY,cAAZ,EAA4BF,IAA5B;AACH;;;gCAEOA,I,EAAM;AACVV,eAAGC,GAAH,CAAO,aAAP;AACA,iBAAKN,YAAL,GAAoB,KAApB;AACA,iBAAKC,SAAL,GAAiB,KAAjB;AACA,iBAAKF,IAAL,GAAY,IAAZ;AACAiB,mBAAOC,IAAP,CAAY,SAAZ,EAAuBF,IAAvB;AACH;;;8BAEKG,S,EAAWH,I,EAAM;AACnBV,eAAGC,GAAH,CAAO,WAAP,EAAoBY,SAApB,EAA+BH,IAA/B;AACAC,mBAAOC,IAAP,CAAYC,SAAZ,EAAuBH,IAAvB;AACH;;;qCAEY;AACT,iBAAKhB,IAAL,IAAa,KAAKA,IAAL,CAAUoB,KAAV,EAAb;AACH;;AAED;;;;;;;6BAIKC,K,EAAOF,S,EAAWH,I,EAAM;AACzBK,oBAAQA,SAAS,OAAjB;AACAF,wBAAYA,aAAa,SAAzB;AACA,gBAAI,KAAKnB,IAAL,IAAa,IAAjB,EACI;;AAEJsB,oBAAQC,KAAR,CAAcJ,SAAd,EAAyBH,IAAzB;AACA,iBAAKhB,IAAL,CAAUwB,IAAV,CAAeH,KAAf,EAAsBF,SAAtB,EAAiCH,IAAjC;AACH;;;;;;AAILS,OAAOC,OAAP,GAAiB3B,SAAjB","file":"Connector.js","sourcesContent":["var SocketIO = SocketIO || window.io;\n\n\nclass Connector {\n    constructor() {\n        this.sock = null\n        this.isConnecting = false;\n        this.isConnect = false\n        this.activeDisConnect = false;\n    }\n\n    connect(uri) {\n        this.serverURI = uri;\n        this.sock = null;\n        this.isConnecting = true;\n\n        cc.log(\"正在连接中...\", uri);\n        this.sock = SocketIO.connect(uri, {\n            reconnection: false\n        });\n        //链接事件\n        this.sock.on(\"connect\", this.onConnect.bind(this));\n        this.sock.on(\"disconnect\", this.onDisconnect.bind(this));\n        this.sock.on(\"error\", this.onError.bind(this));\n        this.sock.on(\"msg\", this.onMsg.bind(this));\n    }\n\n    onConnect(data) {\n        cc.log(\"连接成功: \" + this.serverURI);\n        this.isConnect = true;\n        this.isConnecting = false;\n        onfire.fire(\"onConnect\", data)\n    }\n\n    onDisconnect(data) {\n        cc.log(\"断开连接----\", data);\n        this.isConnect = false;\n        this.isConnecting = false;\n        this.sock = null;\n        onfire.fire(\"onDisconnect\", data)\n    }\n\n    onError(data) {\n        cc.log(\"onError----\");\n        this.isConnecting = false;\n        this.isConnect = false;\n        this.sock = null;\n        onfire.fire(\"onError\", data)\n    }\n\n    onMsg(eventName, data) {\n        cc.log(\"onMsg----\", eventName, data);\n        onfire.fire(eventName, data)\n    }\n\n    disconnect() {\n        this.sock && this.sock.close()\n    }\n\n    /**\n     * 发送数据包\n     * @param data\n     */\n    emit(route, eventName, data) {\n        route = route || \"plaza\"\n        eventName = eventName || \"message\";\n        if (this.sock == null)\n            return;\n\n        console.error(eventName, data)\n        this.sock.emit(route, eventName, data);\n    }\n\n}\n\nmodule.exports = Connector"]}